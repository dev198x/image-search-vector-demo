# Image Search with MongoDB Atlas Vector Search

This repository contains a Jupyter Notebook demonstrating how to generate
vector embeddings for both text and images using a multi-modal embedding model.

## Getting Ready To Run The Notebook

The first thing you'll want to do is create a virtual environment using your favorite technique. I tend to use [venv](https://docs.python.org/3/library/venv.html), which comes with Python.

Once you've done that, install dependencies with:

```
pip install -r requirements.txt
```

You'll need to set an environment variable, `MONGODB_URI`, containing the connection string for your MongoDB cluster.

One more thing you'll need is an "images" directory, containing some images to index! I downloaded Â [Kaggle's ImageNet 1000 (mini) dataset](https://www.kaggle.com/datasets/ifigotin/imagenetmini-1000), which contains lots of images at around 4GB, but you can use a different dataset if you prefer. The notebook searches the "images" directory recursively, so you don't need to have everything at the top-level.

Then you can fire up the notebook with:

```
jupyter notebook "Image Search.ipynb"
```

At the end of the tutorial, you'll be able to search for images with snippets
of text, like this:

![A screenshot of a line of code searching for "corgi in the snow" followed by a grid of animal photos.](readme_images/screenshot.png)

## guide for dev
- Vector Search With MongoDB and OpenAI: https://www.mongodb.com/developer/products/atlas/quickstart-vectorsearch-mongodb-python/
![image description](./Big_Picture.png)
```bash

touch .env
# MONGODB_URI = "mongodb+srv://username:pass@cluster0.wpnf1.mongodb.net/"

# update code to load
from dotenv import load_dotenv
load_dotenv()  # Load the .env file

```
## Query
```js
search_phrase = "there fishes in water and green background"
emb = model.encode(search_phrase)
raw_query_aggregate = [
    {
        "$vectorSearch": {
            "index": "default",
            "path": "embedding",
            "queryVector": emb.tolist(),
            "numCandidates": 100,
            "limit": 9,
        }
    },
    {"$project": {"_id": 1, "score": {"$meta": "vectorSearchScore"}}},
]

// raw_query_aggregate [{'$vectorSearch': {'index': 'default', 'path': 'embedding', 'queryVector': [-0.6621323823928833, 0.350708931684494, 0.04059460759162903, -0.4626387655735016, -0.16522493958473206, 0.14391720294952393, 0.25633734464645386, -0.19902083277702332, -0.5519498586654663, 0.20671799778938293, 0.0711631178855896, -0.41631847620010376, 0.2619814872741699, -0.04365891218185425, 0.56267249584198, 0.0665183812379837, -0.5844237208366394, 0.2961355149745941, -0.05149412155151367, -0.2744152545928955, -0.19938848912715912, 0.589232861995697, 0.34046733379364014, 0.16589945554733276, 0.31487876176834106, -0.4952656328678131, -0.26572757959365845, -0.3057047724723816, 0.38565903902053833, -0.27716773748397827, -0.09716422110795975, 0.005163058638572693, 0.014636501669883728, 0.03300439566373825, 0.6828650236129761, 0.11179740726947784, -0.2375515252351761, -0.17193235456943512, 0.13403329253196716, -0.7181903719902039, -0.3253120183944702, -0.1947258710861206, 0.3211781978607178, 0.2522818446159363, -0.6003550291061401, 0.15651971101760864, 0.6013420224189758, 0.3565472364425659, 0.7015618085861206, 0.19625750184059143, -0.39459508657455444, -0.04328310489654541, -0.4860093593597412, -0.12692391872406006, 0.3962414860725403, -0.7523265480995178, 0.17893171310424805, -0.12455317378044128, 0.048822760581970215, -0.07096533477306366, -0.2587168216705322, 0.11659014225006104, -0.4173712730407715, 0.6982731819152832, -0.9010181427001953, 0.3692837953567505, 0.1573742926120758, -0.16086207330226898, -0.4498903155326843, 0.08300025761127472, 0.1326550841331482, -0.6721111536026001, -0.3947257995605469, 0.6778181791305542, -0.14144760370254517, 0.27620771527290344, -0.103221595287323, -0.4170556664466858, -0.16976970434188843, 0.5146331191062927, -0.2225724458694458, -0.6458762884140015, 0.10587155818939209, 0.10650993883609772, 0.3933468461036682, -0.32683899998664856, -0.09025189280509949, 0.5405557155609131, 0.327793151140213, -0.3681889474391937, -0.5969946384429932, -0.2287636250257492, 0.321219265460968, -0.5856732130050659, 0.7414612770080566, -0.17095085978507996, 0.292222797870636, 0.2944585084915161, 0.32302621006965637, -0.5686138272285461, 0.6857482194900513, -0.2774044871330261, 0.6232757568359375, 0.5319540500640869, 0.11898458003997803, 0.2977702021598816, -0.1525217592716217, -0.08000153303146362, 0.652127742767334, -0.3545435965061188, 0.04775628447532654, -0.6343269944190979, -0.0928502231836319, 0.30025386810302734, -0.25970983505249023, 0.019658870995044708, 0.24928247928619385, 0.428591251373291, 0.2430170476436615, -0.573606550693512, -0.550729513168335, -0.3618886172771454, 0.36246079206466675, 0.08408620953559875, -0.03270449489355087, -0.06066025793552399, -0.35531580448150635, 0.07173466682434082, 0.0508362352848053, -0.4950471818447113, 0.3477543294429779, -0.3504020571708679, 0.5141072869300842, -0.3359295129776001, -0.224503755569458, -0.038541436195373535, 0.7788786292076111, 0.29429498314857483, 0.16003334522247314, 0.411172479391098, 0.14552688598632812, 0.2523624300956726, 0.16069245338439941, 0.036576613783836365, -0.5199292898178101, 0.22330626845359802, -0.2943241596221924, 0.1754320114850998, 0.20691624283790588, -0.13657009601593018, -0.12142136693000793, 0.2326868176460266, -0.12870052456855774, -0.8216005563735962, -0.05873548984527588, 0.055109307169914246, -0.26623159646987915, -0.39063557982444763, -0.21158581972122192, -0.01090306043624878, 0.17246000468730927, 0.0654572993516922, -0.34594491124153137, 0.06823611259460449, -0.7217838168144226, 0.034241750836372375, -0.2339775562286377, -0.14637377858161926, 0.04135747253894806, -0.7399827241897583, -0.1129612922668457, 0.6305985450744629, 0.21859169006347656, 0.23388230800628662, -0.8618573546409607, 0.9769952893257141, -0.39113226532936096, -0.7693295478820801, 0.7324063777923584, -0.31011706590652466, 0.6589601039886475, -0.9767706394195557, -0.5676382184028625, 0.4297026991844177, 0.471113920211792, -0.2922609746456146, -0.1535160094499588, -0.7291088700294495, -0.6204326748847961, -0.49619510769844055, 0.3753412365913391, 0.0576092004776001, 0.10197801887989044, -0.10640126466751099, 0.5512189865112305, -0.573590874671936, 0.7831704616546631, 0.045453786849975586, -0.30030736327171326, -0.25309279561042786, 0.5145543813705444, 0.6387205123901367, -0.16944092512130737, -0.12354322522878647, -0.22829243540763855, -0.16292135417461395, 0.5730726718902588, 0.5022909641265869, -0.10084965825080872, 1.2647066116333008, -0.1686035394668579, -0.3626888692378998, 0.18023782968521118, 0.41525110602378845, 0.2923867404460907, -0.2527504563331604, -0.01961703598499298, -0.12142437696456909, -0.05185645818710327, 0.19693872332572937, 0.41597235202789307, -0.01156643033027649, 0.3262442946434021, -0.25660836696624756, -0.46690863370895386, 0.4113033413887024, 0.3115593194961548, 0.04659047722816467, 0.1824224591255188, -0.701583981513977, -0.14105010032653809, -0.26543816924095154, 0.06990309059619904, 0.3992297649383545, 0.35853826999664307, -0.09229163825511932, 0.09987622499465942, -0.2770687937736511, -0.43470504879951477, -0.11759286373853683, 0.5644884705543518, -0.7765179872512817, -0.28055238723754883, 0.38261038064956665, -0.13044396042823792, 0.16636231541633606, -0.01869478076696396, -0.7571993470191956, 0.45567962527275085, 0.13501065969467163, -0.34380149841308594, -0.4299463927745819, 0.9012463688850403, -0.5783511400222778, 0.22726191580295563, -0.5555355548858643, 0.2512340247631073, -0.048384666442871094, 0.504158616065979, 0.28560495376586914, 0.05097705125808716, 0.14985544979572296, 0.1584419310092926, 0.07136370241641998, -0.1569799780845642, 0.03629379719495773, 0.07813504338264465, 0.4042673707008362, 0.5613834857940674, 0.33960527181625366, 0.30458590388298035, 0.23977354168891907, -0.008832845836877823, -0.7735134959220886, 0.5565804839134216, 0.01966939866542816, 0.800233006477356, -0.4700371026992798, -0.28879624605178833, -0.2328493893146515, -0.031214088201522827, 0.16215041279792786, 0.23525190353393555, -0.24444842338562012, -0.30061793327331543, 0.4649490714073181, 0.14957985281944275, 0.2268255054950714, 0.07787039875984192, -0.3087526261806488, -0.38552311062812805, 0.0092916339635849, -0.46213018894195557, -0.3795018196105957, -0.13877786695957184, -0.2818216383457184, -0.14934435486793518, -0.49199795722961426, 0.21721883118152618, -0.12173964083194733, -0.48069584369659424, 0.3586670458316803, 0.4379903972148895, 0.5091226100921631, 0.327231764793396, 0.19481319189071655, -0.7523924112319946, 0.2263190895318985, -0.04610186070203781, -0.11767859756946564, 0.5093109607696533, 0.3728683590888977, -0.36789000034332275, 0.7653064727783203, -0.6841804385185242, -0.2712850272655487, -5.892839431762695, 0.003413677215576172, 0.23714053630828857, 0.7297641038894653, 0.13291266560554504, -0.0005990415811538696, 0.9439702033996582, 0.018448039889335632, 0.4760495126247406, -0.028277039527893066, -0.5208971500396729, -0.6029558181762695, 0.7716690301895142, 0.12523514032363892, -0.621523380279541, 0.10957567393779755, -0.37371528148651123, 0.30087631940841675, 0.1686607301235199, -0.1868334710597992, 0.2546176016330719, 0.059843212366104126, -0.3753055930137634, 0.9633586406707764, -0.36241501569747925, 0.480473130941391, 0.40005284547805786, 0.031058311462402344, 0.16965003311634064, 0.04887872934341431, 0.18702691793441772, 0.06282530725002289, 0.23086665570735931, 0.6628854274749756, 0.26826444268226624, 0.11205774545669556, -0.09547784924507141, -0.43007582426071167, 0.5797459483146667, -0.24605023860931396, -0.9547592401504517, 0.09560659527778625, -0.03864137828350067, -0.15658943355083466, -0.2749888300895691, -0.03481345623731613, 0.11898854374885559, -0.5031735301017761, -0.12335347384214401, 0.2009163647890091, -0.8732284903526306, -0.5167896747589111, 0.5263302326202393, -0.21201613545417786, 0.43019914627075195, 0.7847989797592163, 0.004108982160687447, -0.11194998025894165, 0.03197696805000305, -0.2673790752887726, -0.15171414613723755, 0.3731653094291687, -0.4743492603302002, 0.1374308317899704, -0.935620129108429, -0.1614111065864563, -0.09403659403324127, -0.26076722145080566, -0.43667662143707275, 0.14839580655097961, 0.4127693772315979, -0.47825270891189575, -0.3153064250946045, -0.4543699026107788, -0.0711098462343216, -0.5042874813079834, -0.3033856153488159, 0.0005104169249534607, 0.038689542561769485, -0.04118899255990982, -0.35900628566741943, -1.4886378049850464, 0.33604127168655396, 0.5212805271148682, -0.8565008640289307, 0.09586513042449951, 0.37756025791168213, 0.7421067953109741, -0.39850324392318726, -0.11237593740224838, 1.0704345703125, -0.31811338663101196, -0.22145310044288635, -0.0021616071462631226, 0.3686298131942749, -0.43158483505249023, 0.895704984664917, -0.4569932222366333, -0.3295350968837738, -0.21749241650104523, 0.11071914434432983, 0.36432307958602905, -0.5290389657020569, 0.7323150634765625, 0.015267767012119293, 0.40378105640411377, 0.25455886125564575, 0.2744746804237366, 0.6634775996208191, -0.5987894535064697, -0.47593724727630615, -0.20836377143859863, -0.06550326198339462, 0.011711984872817993, 0.27619022130966187, 0.24027398228645325, 0.5004442930221558, 0.05423635244369507, 0.04441408812999725, 0.12669140100479126, 0.5560601353645325, -0.8744032979011536, -0.03084132820367813, -0.3472539782524109, 5.981996536254883, 0.05818620324134827, 0.4993663430213928, -0.01013214886188507, 0.8174869418144226, 0.4109397530555725, 0.7814303636550903, -0.8628360033035278, -0.06840048730373383, 0.422646701335907, -0.5378024578094482, -0.18335753679275513, 0.6704093813896179, -0.2514018416404724, 0.4050248861312866, 0.12493842840194702, -0.6395068168640137, 0.17737630009651184, -0.36462467908859253, 1.0288347005844116, 0.6869549751281738, -0.4495677947998047, 0.11542102694511414, 0.2889307737350464, -0.4074624180793762, -0.03560921549797058, 0.14150699973106384, -1.0448263883590698, 0.5604940056800842, 0.3399919867515564, 0.21077939867973328, 0.17825090885162354, 0.16189423203468323, 0.08463181555271149, -0.9288485050201416, -0.5094634294509888, -0.14422862231731415, -0.7202569246292114, -0.668135941028595, 0.14084197580814362, -0.07788394391536713, 0.4876076579093933, -0.6018691658973694, 0.15210096538066864, -0.38530924916267395, -0.41827186942100525, 0.14849115908145905, -0.6153253316879272, -0.5668763518333435, 0.18762695789337158, -0.34651196002960205, 0.7553204894065857, -1.0287175178527832, -0.08413440734148026, 0.18360045552253723, -0.5800235271453857, -0.0743720680475235, -0.09347465634346008, -0.638751745223999, 0.04386892914772034, -0.10579729825258255, -0.06989520788192749, -0.17494086921215057, 0.09682178497314453, -0.11089438199996948, -0.025050252676010132, -0.11512377113103867, -0.09488722681999207, 0.6697918176651001, -0.25084197521209717, -0.0235292911529541, 0.008456051349639893, -1.0183980464935303, -0.07025174796581268, -0.3255655765533447, 0.02052786946296692, 0.037079863250255585, 0.8255581855773926, 0.06856484711170197, 0.09225551038980484, 0.1375618726015091, 0.01888972520828247, 0.3748699426651001, 0.8354965448379517, -0.28970855474472046, -0.04691717028617859, -0.12921743094921112, 0.0022166594862937927, -0.23233662545681, 0.43291184306144714, 0.40911856293678284, -0.24443739652633667, 0.23343737423419952, 0.2777819037437439, -0.13031983375549316, -0.3830384314060211, -0.3639897108078003, 0.2279995083808899, -0.08561201393604279, 0.43706250190734863, -0.4071696400642395, -0.6964077949523926, 0.2078169733285904, -0.3154238164424896, -0.39396119117736816, -0.05998937785625458, -0.03787994384765625, 0.27333974838256836, 0.14317554235458374, -0.0677017942070961, -0.09751710295677185, -0.02542167901992798, -0.024978674948215485, -0.6058610677719116, 0.21521523594856262, 0.08999858051538467, -1.1608757972717285, 0.5710225105285645, -0.43081551790237427, 0.07628149539232254, -0.5192949771881104, 0.23347584903240204, -0.479686975479126, 0.22508536279201508, 0.48352473974227905, 0.14564979076385498, -0.4683062434196472, 0.13707378506660461, -0.03876137733459473, -0.033052295446395874, -0.5677701830863953, 0.38104113936424255, -0.6545852422714233, 0.6377946138381958, 0.3836938142776489, -0.5107911825180054, -0.24255062639713287, -0.3697657883167267, -0.1587020456790924, -0.19156718254089355, -0.19984062016010284, -0.1421990692615509, -0.10661700367927551, 0.29771527647972107, 0.10773025453090668, -0.5489884614944458, -0.014387786388397217, 0.4821164608001709, 0.36315369606018066, -0.4741032123565674, 0.026786163449287415, -0.7948154211044312, 0.3894134759902954, -0.46890121698379517, 0.3750113546848297, 0.2699556350708008, -0.04487142711877823, -0.33221960067749023, -0.4506066143512726, -0.34678900241851807, 0.14505544304847717, 0.003650948405265808, -0.16133804619312286, 0.08151091635227203, 0.2837859094142914, -1.0774879455566406, 0.31917110085487366, -0.3913533687591553, 0.452108770608902, -0.6207494735717773, 0.025919556617736816, -0.11069812625646591, 0.7543046474456787, -0.025254935026168823, 0.2162475436925888, -0.06528154015541077, -0.46531563997268677, -0.8237980604171753, 0.5503212809562683, 0.3847285509109497, 0.17111998796463013, -0.044039398431777954, -0.3747313618659973, 0.3784042000770569, -0.768512487411499, 0.33586061000823975, -0.7708783149719238, -0.567635178565979, -0.5592145919799805, -0.17015251517295837, -0.260379433631897, -0.3892008066177368, 0.13014279305934906, -0.27593114972114563, 0.21544504165649414, 0.4487149119377136, -0.2536870241165161, 0.5438112616539001, 0.31873536109924316, -0.19311031699180603, -0.03896975517272949, -0.16174769401550293, -0.12314304709434509, -0.7057524919509888, 0.46537333726882935, 0.21847593784332275, 0.4302372932434082, 0.5575734376907349, -0.12325157970190048, -0.06918945908546448, -0.24275830388069153, 0.09303981810808182, 0.32788604497909546, -0.41441598534584045, 0.5177175998687744, 0.41221708059310913, 0.2359817922115326, 0.1317673921585083, -0.19770608842372894, 0.3372262418270111, -1.1246094703674316, 0.013699959963560104, -0.17187896370887756, -0.6713815927505493, 0.26471924781799316, -0.20893025398254395, 0.17635196447372437, 0.7764009833335876, -0.4028432369232178, 0.11688296496868134, -0.24414436519145966, 0.034005820751190186, -0.5949895977973938, -0.12775510549545288, -0.19714662432670593, -0.45896103978157043, -0.9279041290283203, 0.34234797954559326, -0.2818688452243805, 0.41360193490982056, 0.15213748812675476, 0.17267675697803497, 0.2860253155231476, -0.16079771518707275, -0.2667044401168823, -0.40602514147758484, -0.33971062302589417, 0.17228426039218903, 0.004261739086359739, -0.14436468482017517, 0.42874228954315186, 0.18290865421295166, 0.19526830315589905, 0.3694697618484497, 0.5305972099304199, 0.28545790910720825, -0.340707927942276, 0.27588072419166565, 0.2844353914260864, -0.001216791570186615, -0.8294264078140259, -0.28445079922676086, 0.15033328533172607, -1.1746770143508911, 0.16385847330093384, 0.2984229326248169, -0.3042261004447937, 0.3600045144557953, 0.5481076240539551, 0.2792688012123108, -0.14414697885513306, 0.07962703704833984, -0.023846782743930817, 0.413806676864624, -0.7692093849182129, 0.3295765519142151, 0.13133233785629272, 0.09654229879379272, -0.35044997930526733, -0.35390233993530273, -0.21433117985725403, -0.2804124355316162, 0.159035325050354, -0.018894076347351074, 0.629989743232727, 0.8563001155853271, 0.5692877173423767, -0.042298853397369385, -0.2315738946199417, 0.2758238911628723, -0.17438212037086487, 0.3044990003108978, 0.17542102932929993, -0.48489895462989807, -0.7309790849685669, 0.6001185178756714, 0.08285693824291229, -0.18816962838172913, 0.21399173140525818, -0.15040680766105652, 0.054781973361968994, -0.052934855222702026, 0.24250206351280212, -0.5155522227287292, -0.041765809059143066, 0.3798540532588959, -0.023695185780525208, -0.05450707674026489, 0.5538085699081421, -0.5232229232788086, 0.05149023234844208, -0.3766478896141052, -0.10254240036010742, 0.7124536037445068, 0.40001237392425537, -1.032564401626587, -0.6208192110061646, -0.17888322472572327, 0.16066184639930725, -0.09026695042848587, 0.33337152004241943, -0.11426305770874023, -0.22942624986171722, -0.006063491106033325, 0.2509627640247345, -0.5229835510253906, 0.0960717648267746, -0.18457382917404175], 'numCandidates': 100, 'limit': 9}}, {'$project': {'_id': 1, 'score': {'$meta': 'vectorSearchScore'}}}]

collection.aggregate(raw_query_aggregate)
```